<html lang="en" xmlns:th="http://www.thymeleaf.org"  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Take That Car! - List of cars</title>
    <style>
        section{
            padding: 60px 0;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
</head>
<body>
<div th:insert="../static/navbar"></div>
<div class="container" sec:authorize="hasRole('ROLE_ADMIN')">
    <a th:href = "@{/addCar}" class="btn btn-warning btn-sm  mb-3 mt-3 ms-3"> Add Car </a>
    <div th:if="${param.deletionSucced}" class="alert alert-warning" role="alert">
        <div class="col-md-5 text-center text-md-start align-items-center">Car deleted!</div>
    </div>
</div>
<!-- cars display-->
<!-- load JS functions-->
<script src="/js/functions.js"></script>
<div class="container-lg">
    <form id="filters">
        <div class="container">
            <!-- Select car type -->
            <div class="row align-items-center">
              <div class="col-md-3 col-6 mb-2">
                <label for="typeChose">Select car type:</label>
                <select class="form-select" id="typeChose">
                    <option th:value="0">Chose car type...</option>
                    <option th:each="carType: ${carTypes}" th:text="${carType}" th:value="${carType}">text</option>
                </select>
              </div>
                <!-- Search By-->
              <div class="col-none col-md-3" ></div>
              <div class="col-3">
                <label for="searchByForm">Search by:  </label>
                <div class="form-check form-check-inline" id="searchByForm">
                    <input class="form-check-input" type="radio" name="searchBy" id="searchBy" value="Brand">
                    <label class="form-check-label">Brand</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="searchBy" id="searchBy" value="Model">
                    <label class="form-check-label">Model</label>
                  </div>
              </div>
                <!-- search-->
              <div class="col-6 col-md-3 d-inline-flex">
                <form onsubmit="listsCars('carTable',/*[[${restRequestUrl}]]*/)">
                    <input type="text" class="form-control" placeholder="Search..." name="search" id="searchField">
                    <input class="btn btn-secondary" type="submit" value="Search">
                </form>
              </div>
            </div>
            <!-- Price range -->
            <!-- and Date picker-->
            <div class="row mt-1">
                <div class="col-6 col-md-3">
                    <label for="minPrice">Min price:</label>
                    <input type="text" class="form-control" id="minPrice" name="minPrice" placeholder="0">
                </div>
                <!-- Date picker-->
                <div class="col-6 col-lg-3">
                    <label for="datepicker1">Start date:</label>
                    <div class="input-group date datepicker" id="datepicker1">
                        <input type="text" class="form-control" name="startDate" id="startDate" placeholder="12-01-2022" value ="">
                        <span class="input-group-append">
                            <span class="input-group-text bg-white d-block">
                                <i class="fa fa-calendar"></i>
                            </span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row mt-1">
                <div class="col-6 col-md-3">
                    <label for="maxPrice">Max price:</label>
                    <input type="text" class="form-control" id="maxPrice" name="maxPrice" placeholder="0">
                </div>
                <!-- Date picker-->
                <div class="col-6 col-lg-3">
                    <label for="datepicker2">End date:</label>
                    <div class="input-group date datepicker" id="datepicker2">
                        <input type="text" class="form-control" name="endDate" id="endDate" placeholder="12-01-2022" value="">
                        <span class="input-group-append">
                            <span class="input-group-text bg-white d-block">
                                <i class="fa fa-calendar"></i>
                            </span>
                        </span>
                    </div>
                </div>
            </div>
            <!-- Order By-->
            <div class="row align-items-center mt-1 mb-5">
              <div class="col-7">
                <label for="orderByForm" class="me-2">Order by:  </label>
                <div class="form-check form-check-inline" id="orderByForm">
                    <input class="form-check-input" type="radio" name="orderBy" id="orderBy" value="priceAsc">
                    <label class="form-check-label" for="checkBrand">Price <i class="bi bi-arrow-up"></i></label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="orderBy" id="orderBy" value="priceDesc">
                    <label class="form-check-label" for="checkModel">Price <i class="bi bi-arrow-down"></i></label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="orderBy" id="orderBy" value="brandAsc">
                    <label class="form-check-label" for="checkModel">Brand <i class="bi bi-arrow-up"></i></label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="orderBy" id="orderBy" value="brandDesc">
                    <label class="form-check-label" for="checkModel">Brand <i class="bi bi-arrow-down"></i></label>
                  </div>
              </div>
            </div>
        </div>
    </form>

    <table class="table table-striped table-hover ">
        <thead>
            <tr class="">
                <th scope="col">Car image</th>
                <th scope="col">Brand</th>
                <th scope="col">Model</th>
                <th scope="col">Engine</th>
                <th scope="col">HP</th>
                <th scope="col">Fuel</th>
                <th scope="col">Type</th>
                <th scope="col">Sitting places</th>
                <th scope="col">Price</th>
                <th scope="col" sec:authorize="hasRole('ROLE_ADMIN')">Actions</th>
            </tr>
          </thead>
          <tbody id="carTable" sec:authorize="hasRole('ROLE_ADMIN')">
            <script th:inline="javascript">
                /*<![CDATA[*/
                listsCars('carTable',/*[[${restRequestUrl}]]*/,true);
                /*]]>*/
            </script>
          </tbody>

        <tbody id="carTable1" sec:authorize="!hasRole('ROLE_ADMIN')">
            <script th:inline="javascript">
        /*<![CDATA[*/
        listsCars('carTable1',/*[[${restRequestUrl}]]*/,false);
        /*]]>*/
        </script>
        </tbody>
    </table>
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#">Next</a>
            </li>
        </ul>
    </nav>
</div>
<script type="text/javascript">
    (function(){
        "use strict";

        document.getElementById('filters').addEventListener('submit',displayCarsOnEvent);

        function displayCarsOnEvent(event){
            event.preventDefault();

            var typeChose = document.getElementById('typeChose').value;
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
            var searchBy = null;
            if(document.querySelector('input[name=searchBy]:checked')!=null){
                searchBy = document.querySelector('input[name=searchBy]:checked').value;
                console.log("searchBy " + searchBy);
            }
            var searchQuery = document.getElementById('searchField').value;
            var maxPrice = document.getElementById('maxPrice').value;
            var minPrice = document.getElementById('minPrice').value;
            var orderBy = null;
            if(document.querySelector('input[name=orderBy]:checked')!=null){
                orderBy = document.querySelector('input[name=orderBy]:checked').value;
                console.log("orderByForm " + orderBy);
            }
            

            if(startDate.value === ""){
                alert("Please fill up Start date field");
                startDateField.focus();
                return;
            }
            document.getElementById('carTable').innerHTML = "";

            var carQueryToRest = "/cars?type=" + typeChose
                              + "&startDate=" + startDate
                              + "&endDate=" + endDate
                              + "&searchBy=" + searchBy
                              + "&maxPrice=" + maxPrice
                              + "&minPrice=" + minPrice
                              + "&orderBy=" + orderBy
                              + "&searchQuery=" + searchQuery;

            listsCars('carTable',carQueryToRest);
        }
    })();
    $(function() {
        $("#datepicker1, #datepicker2").datepicker({
                                                        //viewMode: 'months',
                                                        format: 'dd-mm-yyyy',
                                                    });
    });
</script>
<footer>
    <div class="container-lg">
    <a href="https://www.flaticon.com/free-icons/car" title="car icons">Car icons created by Freepik - Flaticon</a>
    Menu Icon created by Caleb Amesbury
    http://calebamesbury.com
    http://dribbble.com/CalebAmesbury
    </div>
</footer>
</body>
</html>